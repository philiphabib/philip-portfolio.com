<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Portfolio CRUD Users â€“ Modern UI with Search</title>
<!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<!-- Animate.css -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
<style>
body { background: #f8f9fa; }
h1 { text-align: center; margin: 20px 0; color: #343a40; }
.card { transition: transform 0.3s, box-shadow 0.3s; }
.card:hover { transform: translateY(-5px); box-shadow: 0 12px 20px rgba(0,0,0,0.2); }
.card input { margin-bottom: 5px; }
.btn-update { background-color: #17a2b8; color: white; }
.btn-update:hover { background-color: #117a8b; }
.btn-delete { background-color: #dc3545; color: white; }
.btn-delete:hover { background-color: #a71d2a; }
.toast-container { position: fixed; top: 20px; right: 20px; z-index: 1080; }
</style>
</head>
<body>

<div class="container">
    <h1>AWS Serverless CRUD app with Lambda, API Gateway, DynamoDB, CORS REST endpoints, automated tests, and frontend UI</h1>

    <!-- CREATE USER FORM -->
    <div class="card p-3 mb-4">
        <h4>Create New User</h4>
        <div class="row g-2">
            <div class="col-md-3"><input id="c_userId" class="form-control" placeholder="User ID"></div>
            <div class="col-md-3"><input id="c_name" class="form-control" placeholder="Name"></div>
            <div class="col-md-3"><input id="c_email" class="form-control" placeholder="Email"></div>
            <div class="col-md-2"><input id="c_age" type="number" class="form-control" placeholder="Age"></div>
            <div class="col-md-1"><button class="btn btn-primary w-100" onclick="createUser()">Create</button></div>
        </div>
    </div>

    <!-- SEARCH BAR -->
    <div class="mb-3">
        <input id="searchInput" type="text" class="form-control" placeholder="Search users by name, email, or ID" oninput="filterUsers()">
    </div>

    <!-- USERS CARDS -->
    <div class="row" id="usersContainer"></div>
</div>

<!-- DELETE CONFIRM MODAL -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title" id="deleteModalLabel">Confirm Delete</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        Are you sure you want to delete this user?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-danger" id="confirmDeleteBtn">Delete</button>
      </div>
    </div>
  </div>
</div>

<!-- Toast Notifications -->
<div class="toast-container" id="toastContainer"></div>

<!-- Bootstrap JS Bundle -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
const API = "https://i9wm4w38r9.execute-api.us-east-1.amazonaws.com/prod/users";
let deleteUserId = null;
let usersData = []; // store all users

// Toast helper
function showToast(message, color="success") {
    const toastEl = document.createElement('div');
    toastEl.className = `toast align-items-center text-bg-${color} border-0 show`;
    toastEl.role = "alert";
    toastEl.innerHTML = `
        <div class="d-flex">
            <div class="toast-body">${message}</div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
        </div>`;
    document.getElementById('toastContainer').appendChild(toastEl);
    setTimeout(() => toastEl.remove(), 4000);
}

// Helper: create user card element
function createUserCard(user) {
    const col = document.createElement('div');
    col.className = 'col-md-4 animate__animated animate__fadeIn';
    col.dataset.userId = user.userId.toLowerCase();
    col.dataset.name = user.name.toLowerCase();
    col.dataset.email = user.email.toLowerCase();

    const card = document.createElement('div');
    card.className = 'card p-3 mb-4';

    card.innerHTML = `
        <div class="mb-2"><input type="text" value="${user.name}" id="name-${user.userId}" class="form-control" placeholder="Name"></div>
        <div class="mb-2"><input type="text" value="${user.email}" id="email-${user.userId}" class="form-control" placeholder="Email"></div>
        <div class="mb-2"><input type="number" value="${user.age}" id="age-${user.userId}" class="form-control" placeholder="Age"></div>
        <p><strong>ID:</strong> ${user.userId}</p>
        <div class="d-flex gap-2">
            <button class="btn btn-update w-50" onclick="updateCardUser('${user.userId}')">Update</button>
            <button class="btn btn-delete w-50" onclick="showDeleteModal('${user.userId}')">Delete</button>
        </div>
    `;
    col.appendChild(card);
    return col;
}

// Render users
function renderUsers(filtered=usersData) {
    const container = document.getElementById('usersContainer');
    container.innerHTML = '';
    if (filtered.length === 0) {
        container.innerHTML = '<p class="text-center">No users found.</p>';
    } else {
        filtered.forEach(user => container.appendChild(createUserCard(user)));
    }
}

// FILTER USERS
function filterUsers() {
    const term = document.getElementById('searchInput').value.toLowerCase();
    const filtered = usersData.filter(u =>
        u.name.toLowerCase().includes(term) ||
        u.email.toLowerCase().includes(term) ||
        u.userId.toLowerCase().includes(term)
    );
    renderUsers(filtered);
}

// Fetch and store all users
async function fetchUsers() {
    try {
        const res = await fetch(API);
        const data = await res.json();
        usersData = data.users || [];
        renderUsers();
    } catch (err) { console.error(err); }
}

// CREATE USER
async function createUser() {
    const body = {
        userId: document.getElementById("c_userId").value,
        name: document.getElementById("c_name").value,
        email: document.getElementById("c_email").value,
        age: Number(document.getElementById("c_age").value)
    };
    try {
        await fetch(API, { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify(body) });
        showToast("User created successfully!");
        fetchUsers();
    } catch (err) { console.error(err); }
}

// UPDATE USER
async function updateCardUser(userId) {
    const body = {
        name: document.getElementById(`name-${userId}`).value,
        email: document.getElementById(`email-${userId}`).value,
        age: Number(document.getElementById(`age-${userId}`).value)
    };
    try {
        await fetch(`${API}?userId=${userId}`, { method: "PUT", headers: { "Content-Type": "application/json" }, body: JSON.stringify(body) });
        showToast("User updated successfully!", "info");
        fetchUsers();
    } catch (err) { console.error(err); }
}

// DELETE USER
function showDeleteModal(userId) {
    deleteUserId = userId;
    const modal = new bootstrap.Modal(document.getElementById('deleteModal'));
    modal.show();
}

document.getElementById('confirmDeleteBtn').addEventListener('click', async () => {
    if (!deleteUserId) return;
    try {
        await fetch(`${API}?userId=${deleteUserId}`, { method: "DELETE" });
        showToast("User deleted successfully!", "danger");
        fetchUsers();
        deleteUserId = null;
        bootstrap.Modal.getInstance(document.getElementById('deleteModal')).hide();
    } catch (err) { console.error(err); }
});

// INITIAL FETCH
fetchUsers();
</script>
</body>
</html>
